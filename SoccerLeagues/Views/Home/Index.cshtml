@model Dictionary<string, List<SoccerLeagues.Entities.ModelsEntities.TeamStatisticsViewModel>>

@{
    ViewData["Title"] = Model.FirstOrDefault().Value.FirstOrDefault()?.LeagueName;
}

<h1>@ViewData["Title"]</h1>

<div id="matches-container"></div>
@foreach (var phaseStats in Model)
{
    <h2>@phaseStats.Key</h2>

    <table class="table">
        <thead>
            <tr>
                <th></th>
                <th>Drużyny</th>
                <th>M</th>
                <th>Z</th>
                <th>R</th>
                <th>P</th>
                <th>BZ</th>
                <th>BS</th>
                <th>+/-</th>
                <th>Ostatnie mecze</th>
                <th>PKT.</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var teamStat in phaseStats.Value)
            {
                <tr>
                    <td>@teamStat.Position</td>
                    <td><button class="show-matches" data-teamname="@teamStat.TeamName">@teamStat.TeamName</button></td>
                    <td>@teamStat.MatchesPlayed</td>
                    <td>@teamStat.Wins</td>
                    <td>@teamStat.Draws</td>
                    <td>@teamStat.Losses</td>
                    <td>@teamStat.GoalsScored</td>
                    <td>@teamStat.GoalsConceded</td>
                    <td>@(teamStat.GoalsScored - teamStat.GoalsConceded)</td>
                    <td>@teamStat.LastResults</td>
                    <td>@teamStat.Points</td>
                </tr>
            }
        </tbody>
    </table>
}

@section Scripts {
    <script>
        $(document).ready(function () {
            $('button.show-matches').click(function () {
                var teamName = $(this).data('teamname');

                $.ajax({
                    url: '/Home/GetMatchesForTeam',
                    type: 'GET',
                    data: { teamName: teamName },
                    success: function (matches) {
                        displayMatches(matches);
                    },
                    error: function (xhr, status, error) {
                        console.error(error);
                    }
                });
            });
        });

        function displayMatches(matches) {
            $('#matches-container').empty();

            if (matches && matches.length > 0) {
                var table = $('<table class="table"></table>');
                var headerRow = $('<thead><tr><th>Wynik</th><th>Przeciwna drużyna</th><th>Punkty</th></tr></thead>');
                table.append(headerRow);

                var tbody = $('<tbody></tbody>');
                matches.forEach(function (match) {
                    var row = $('<tr><td>' + match.result + '</td><td>' + match.opponent + '</td><td>' + match.score + '</td></tr>');
                    tbody.append(row);
                });

                table.append(tbody);
                $('#matches-container').append(table);
            } else {
                $('#matches-container').append('<p>Brak meczów dla wybranej drużyny.</p>');
            }
        }
    </script>
}